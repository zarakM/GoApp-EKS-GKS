version: 2.1
orbs:
  gke: circleci/gcp-gke@1.1.0
  k8s: circleci/kubernetes@0.11.2
  helm: circleci/helm@1.0

jobs:
  cluster_creation:
    parameters:
      create_cluster:
        type: boolean
        default: false
      cluster_name:
        type: string
        default: ""
    machine: true
    steps:
      - when:
          condition: <<parameters.create_cluster>>
          steps:
            - gke/create-cluster:
                additional-args: "--cluster-version=1.16 --enable-ip-alias --num-nodes=1"
                cluster: <<parameters.cluster_name>>
            - gke/create-node-pool:
                additional-args: >-
                  --image-type=cos --machine-type=e2-small --num-nodes=1
                cluster: <<parameters.cluster_name>>
                node-pool: nopool


workflows:
  test:
    jobs:
      - cluster_creation:
          create_cluster: false
          cluster_name: goapp
      # - installing_app
      # - dockerize
      # - installing_app:
      #     requires:
      #       - dockerize
      



      