orbs:
  gcp-gke: circleci/gcp-gke@1.1.0
jobs:
  build:
    machine: true

    steps:
      - checkout
      - run: |
         echo "$dockerhub_pass" | docker login --username zarakmughal --password-stdin

      - run: docker build -t zarakmughal/goapp-cicd:main .

      - run: docker push zarakmughal/goapp-cicd:main

      - gke/create-cluster:
          additional-args: '--cluster-version=1.14 --enable-ip-alias --num-nodes=1'
          cluster: gcp-testing
      - gke/create-node-pool:
          additional-args: >-
            --image-type=WINDOWS_SAC --no-enable-autoupgrade
            --machine-type=n1-standard-2 --num-nodes=1
          cluster: gcp-testing
          node-pool: my-windows-node-pool
          requires:
            - gke/create-cluster